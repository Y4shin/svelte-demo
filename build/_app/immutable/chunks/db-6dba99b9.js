/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var T=function(){return T=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},T.apply(this,arguments)};function Tt(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))}var M=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,j=Object.keys,z=Array.isArray;typeof Promise<"u"&&!M.Promise&&(M.Promise=Promise);function U(t,e){return typeof e!="object"||j(e).forEach(function(n){t[n]=e[n]}),t}var Le=Object.getPrototypeOf,fr={}.hasOwnProperty;function Y(t,e){return fr.call(t,e)}function Ie(t,e){typeof e=="function"&&(e=e(Le(t))),(typeof Reflect>"u"?j:Reflect.ownKeys)(e).forEach(function(n){oe(t,n,e[n])})}var Rn=Object.defineProperty;function oe(t,e,n,r){Rn(t,e,U(n&&Y(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ke(t){return{from:function(e){return t.prototype=Object.create(e.prototype),oe(t.prototype,"constructor",t),{extend:Ie.bind(null,t.prototype)}}}}var hr=Object.getOwnPropertyDescriptor;function tn(t,e){var n=hr(t,e),r;return n||(r=Le(t))&&tn(r,e)}var dr=[].slice;function _t(t,e,n){return dr.call(t,e,n)}function Bn(t,e){return e(t)}function Oe(t){if(!t)throw new Error("Assertion Failed")}function On(t){M.setImmediate?setImmediate(t):setTimeout(t,0)}function Mn(t,e){return t.reduce(function(n,r,i){var a=e(r,i);return a&&(n[a[0]]=a[1]),n},{})}function vr(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function ue(t,e){if(Y(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var a=ue(t,e[r]);n.push(a)}return n}var u=e.indexOf(".");if(u!==-1){var o=t[e.substr(0,u)];return o===void 0?void 0:ue(o,e.substr(u+1))}}function J(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Oe(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)J(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var u=e.substr(0,a),o=e.substr(a+1);if(o==="")n===void 0?z(t)&&!isNaN(parseInt(u))?t.splice(u,1):delete t[u]:t[u]=n;else{var s=t[u];(!s||!Y(t,u))&&(s=t[u]={}),J(s,o,n)}}else n===void 0?z(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function pr(t,e){typeof e=="string"?J(t,e,void 0):"length"in e&&[].map.call(e,function(n){J(t,n,void 0)})}function Fn(t){var e={};for(var n in t)Y(t,n)&&(e[n]=t[n]);return e}var yr=[].concat;function jn(t){return yr.apply([],t)}var Nn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(jn([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return M[t]}),mr=Nn.map(function(t){return M[t]});Mn(Nn,function(t){return[t,!0]});var he=null;function Qe(t){he=typeof WeakMap<"u"&&new WeakMap;var e=Pt(t);return he=null,e}function Pt(t){if(!t||typeof t!="object")return t;var e=he&&he.get(t);if(e)return e;if(z(t)){e=[],he&&he.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Pt(t[n]))}else if(mr.indexOf(t.constructor)>=0)e=t;else{var i=Le(t);e=i===Object.prototype?{}:Object.create(i),he&&he.set(t,e);for(var a in t)Y(t,a)&&(e[a]=Pt(t[a]))}return e}var gr={}.toString;function Rt(t){return gr.call(t).slice(8,-1)}var Bt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",br=typeof Bt=="symbol"?function(t){var e;return t!=null&&(e=t[Bt])&&e.apply(t)}:function(){return null},Ke={};function ie(t){var e,n,r,i;if(arguments.length===1){if(z(t))return t.slice();if(this===Ke&&typeof t=="string")return[t];if(i=br(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var nn=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},te=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ln(t,e){te=t,Vn=e}var Vn=function(){return!0},_r=!new Error("").stack;function Ae(){if(_r)try{throw Ae.arguments,new Error}catch(t){return t}return new Error}function Ot(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Vn).map(function(r){return`
`+r}).join("")):""}var wr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],zn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],rn=wr.concat(zn),xr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Te(t,e){this._e=Ae(),this.name=t,this.message=e}ke(Te).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ot(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Wn(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function ft(t,e,n,r){this._e=Ae(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Wn(t,e)}ke(ft).from(Te);function Fe(t,e){this._e=Ae(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=Wn(t,e)}ke(Fe).from(Te);var an=rn.reduce(function(t,e){return t[e]=e+"Error",t},{}),Er=Te,C=rn.reduce(function(t,e){var n=e+"Error";function r(i,a){this._e=Ae(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=xr[e]||n,this.inner=null)}return ke(r).from(Er),t[e]=r,t},{});C.Syntax=SyntaxError;C.Type=TypeError;C.Range=RangeError;var bn=zn.reduce(function(t,e){return t[e+"Error"]=C[e],t},{});function Ar(t,e){if(!t||t instanceof Te||t instanceof TypeError||t instanceof SyntaxError||!t.name||!bn[t.name])return t;var n=new bn[t.name](e||t.message,t);return"stack"in t&&oe(n,"stack",{get:function(){return this.inner.stack}}),n}var wt=rn.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=C[e]),t},{});wt.ModifyError=ft;wt.DexieError=Te;wt.BulkError=Fe;function O(){}function Xe(t){return t}function Dr(t,e){return t==null||t===Xe?e:function(n){return e(t(n))}}function xe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Sr(t,e){return t===O?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?xe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?xe(i,this.onerror):i),a!==void 0?a:n}}function Kr(t,e){return t===O?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?xe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?xe(r,this.onerror):r)}}function Cr(t,e){return t===O?e:function(n){var r=t.apply(this,arguments);U(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?xe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?xe(a,this.onerror):a),r===void 0?u===void 0?void 0:u:U(r,u)}}function Ir(t,e){return t===O?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function un(t,e){return t===O?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}var Ve={},kr=100,Tr=20,Un=100,on=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Le(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Le(e),t]}(),Mt=on[0],ht=on[1],Ft=on[2],Hn=ht&&ht.then,at=Mt&&Mt.constructor,sn=!!Ft,jt=!1,Pr=Ft?function(){Ft.then(et)}:M.setImmediate?setImmediate.bind(null,et):M.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){et(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(et,0)},ze=function(t,e){Me.push([t,e]),dt&&(Pr(),dt=!1)},Nt=!0,dt=!0,_e=[],ut=[],Lt=null,Vt=Xe,Ce={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{xn(t[0],t[1])}catch{}})}},D=Ce,Me=[],we=0,ot=[];function A(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=O,this._lib=!1;var e=this._PSD=D;if(te&&(this._stackHolder=Ae(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ve)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Wt(this,this._value);return}this._state=null,this._value=null,++e.ref,Qn(this,t)}var zt={get:function(){var t=D,e=vt;function n(r,i){var a=this,u=!t.global&&(t!==D||e!==vt),o=u&&!se(),s=new A(function(c,f){cn(a,new Yn(yt(r,t,u,o),yt(i,t,u,o),c,f,t))});return te&&qn(s,this),s}return n.prototype=Ve,n},set:function(t){oe(this,"then",t&&t.prototype===Ve?zt:{get:function(){return t},set:zt.set})}};Ie(A.prototype,{then:zt,_then:function(t,e){cn(this,new Yn(null,null,t,e,D))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):st(r)}):this.then(null,function(r){return r&&r.name===e?n(r):st(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),st(e)})},stack:{get:function(){if(this._stack)return this._stack;try{jt=!0;var t=Gn(this,[],Tr),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{jt=!1}}},timeout:function(t,e){var n=this;return t<1/0?new A(function(r,i){var a=setTimeout(function(){return i(new C.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&oe(A.prototype,Symbol.toStringTag,"Dexie.Promise");Ce.env=Jn();function Yn(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Ie(A,{all:function(){var t=ie.apply(null,arguments).map(pt);return new A(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,a){return A.resolve(i).then(function(u){t[a]=u,--r||e(t)},n)})})},resolve:function(t){if(t instanceof A)return t;if(t&&typeof t.then=="function")return new A(function(n,r){t.then(n,r)});var e=new A(Ve,!0,t);return qn(e,Lt),e},reject:st,race:function(){var t=ie.apply(null,arguments).map(pt);return new A(function(e,n){t.map(function(r){return A.resolve(r).then(e,n)})})},PSD:{get:function(){return D},set:function(t){return D=t}},totalEchoes:{get:function(){return vt}},newPSD:ve,usePSD:Re,scheduler:{get:function(){return ze},set:function(t){ze=t}},rejectionMapper:{get:function(){return Vt},set:function(t){Vt=t}},follow:function(t,e){return new A(function(n,r){return ve(function(i,a){var u=D;u.unhandleds=[],u.onunhandled=a,u.finalize=xe(function(){var o=this;Br(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),t()},e,n,r)})}});at&&(at.allSettled&&oe(A,"allSettled",function(){var t=ie.apply(null,arguments).map(pt);return new A(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,a){return A.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--n||e(r)})})})}),at.any&&typeof AggregateError<"u"&&oe(A,"any",function(){var t=ie.apply(null,arguments).map(pt);return new A(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(a,u){return A.resolve(a).then(function(o){return e(o)},function(o){i[u]=o,--r||n(new AggregateError(i))})})})}));function Qn(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Ge();n&&typeof n.then=="function"?Qn(t,function(i,a){n instanceof A?n._then(i,a):n.then(i,a)}):(t._state=!0,t._value=n,Xn(t)),r&&qe()}},Wt.bind(null,t))}catch(n){Wt(t,n)}}function Wt(t,e){if(ut.push(e),t._state===null){var n=t._lib&&Ge();e=Vt(e),t._state=!1,t._value=e,te&&e!==null&&typeof e=="object"&&!e._promise&&vr(function(){var r=tn(e,"stack");e._promise=t,oe(e,"stack",{get:function(){return jt?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),Or(t),Xn(t),n&&qe()}}function Xn(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)cn(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),we===0&&(++we,ze(function(){--we===0&&ln()},[]))}function cn(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++we,ze(Rr,[n,t,e])}function Rr(t,e,n){try{Lt=e;var r,i=e._value;e._state?r=t(i):(ut.length&&(ut=[]),r=t(i),ut.indexOf(i)===-1&&Mr(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Lt=null,--we===0&&ln(),--n.psd.ref||n.psd.finalize()}}function Gn(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,a,u;i!=null?(a=i.name||"Error",u=i.message||i,r=Ot(i,0)):(a=i,u=""),e.push(a+(u?": "+u:"")+r)}return te&&(r=Ot(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Gn(t._prev,e,n)),e}function qn(t,e){var n=e?e._numPrev+1:0;n<kr&&(t._prev=e,t._numPrev=n)}function et(){Ge()&&qe()}function Ge(){var t=Nt;return Nt=!1,dt=!1,t}function qe(){var t,e,n;do for(;Me.length>0;)for(t=Me,Me=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Me.length>0);Nt=!0,dt=!0}function ln(){var t=_e;_e=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=ot.slice(0),n=e.length;n;)e[--n]()}function Br(t){function e(){t(),ot.splice(ot.indexOf(e),1)}ot.push(e),++we,ze(function(){--we===0&&ln()},[])}function Or(t){_e.some(function(e){return e._value===t._value})||_e.push(t)}function Mr(t){for(var e=_e.length;e;)if(_e[--e]._value===t._value){_e.splice(e,1);return}}function st(t){return new A(Ve,!1,t)}function F(t,e){var n=D;return function(){var r=Ge(),i=D;try{return pe(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{pe(i,!1),r&&qe()}}}var V={awaits:0,echoes:0,id:0},Fr=0,ct=[],At=0,vt=0,jr=0;function ve(t,e,n,r){var i=D,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++jr;var u=Ce.env;a.env=sn?{Promise:A,PromiseProp:{value:A,configurable:!0,writable:!0},all:A.all,race:A.race,allSettled:A.allSettled,any:A.any,resolve:A.resolve,reject:A.reject,nthen:_n(u.nthen,a),gthen:_n(u.gthen,a)}:{},e&&U(a,e),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Re(a,t,n,r);return a.ref===0&&a.finalize(),o}function Pe(){return V.id||(V.id=++Fr),++V.awaits,V.echoes+=Un,V.id}function se(){return V.awaits?(--V.awaits===0&&(V.id=0),V.echoes=V.awaits*Un,!0):!1}(""+Hn).indexOf("[native code]")===-1&&(Pe=se=O);function pt(t){return V.echoes&&t&&t.constructor===at?(Pe(),t.then(function(e){return se(),e},function(e){return se(),N(e)})):t}function Nr(t){++vt,(!V.echoes||--V.echoes===0)&&(V.echoes=V.id=0),ct.push(D),pe(t,!0)}function Lr(){var t=ct[ct.length-1];ct.pop(),pe(t,!1)}function pe(t,e){var n=D;if((e?V.echoes&&(!At++||t!==D):At&&(!--At||t!==D))&&$n(e?Nr.bind(null,t):Lr),t!==D&&(D=t,n===Ce&&(Ce.env=Jn()),sn)){var r=Ce.env.Promise,i=t.env;ht.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(M,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Jn(){var t=M.Promise;return sn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(M,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:ht.then,gthen:t.prototype.then}:{}}function Re(t,e,n,r,i){var a=D;try{return pe(t,!0),e(n,r,i)}finally{pe(a,!1)}}function $n(t){Hn.call(Mt,t)}function yt(t,e,n,r){return typeof t!="function"?t:function(){var i=D;n&&Pe(),pe(e,!0);try{return t.apply(this,arguments)}finally{pe(i,!1),r&&$n(se)}}}function _n(t,e){return function(n,r){return t.call(this,yt(n,e),yt(r,e))}}var wn="unhandledrejection";function xn(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(M.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(wn,!0,!0),U(r,i)):M.CustomEvent&&(r=new CustomEvent(wn,{detail:i}),U(r,i)),r&&M.dispatchEvent&&(dispatchEvent(r),!M.PromiseRejectionEvent&&M.onunhandledrejection))try{M.onunhandledrejection(r)}catch{}te&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var N=A.reject;function Ut(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!D.letThrough&&!t._vip){if(t._state.openComplete)return N(new C.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return N(new C.DatabaseClosed);t.open().catch(O)}return t._state.dbReadyPromise.then(function(){return Ut(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===an.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return Ut(t,e,n,r)})):N(a)}return i._promise(e,function(a,u){return ve(function(){return D.trans=i,r(a,u,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var En="3.2.2",ge=String.fromCharCode(65535),Ht=-1/0,ne="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Zn="String expected.",je=[],xt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Vr=xt,zr=xt,er=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Et="__dbnames",Dt="readonly",St="readwrite";function Ee(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var tr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tt(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Qe(e),delete e[t]),e}:function(e){return e}}var Wr=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||D.trans,a=this.name;function u(s,c,f){if(!f.schema[a])throw new C.NotFound("Table "+a+" not part of transaction");return n(f.idbtrans,f)}var o=Ge();try{return i&&i.db===this.db?i===D.trans?i._promise(e,u,r):ve(function(){return i._promise(e,u,r)},{trans:i,transless:D.transless||D}):Ut(this.db,e,[this.name],u)}finally{o&&qe()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(z(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=j(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(f){return f.compound&&n.every(function(l){return f.keyPath.indexOf(l)>=0})&&f.keyPath.every(function(l){return n.indexOf(l)>=0})})[0];if(r&&this.db._maxKey!==ge)return this.where(r.name).equals(r.keyPath.map(function(f){return e[f]}));!r&&te&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,a=this.db._deps.indexedDB;function u(f,l){try{return a.cmp(f,l)===0}catch{return!1}}var o=n.reduce(function(f,l){var d=f[0],b=f[1],v=i[l],h=e[l];return[d||v,d||!v?Ee(b,v&&v.multi?function(y){var _=ue(y,l);return z(_)&&_.some(function(w){return u(h,w)})}:function(y){return u(h,ue(y,l))}):b]},[null,null]),s=o[0],c=o[1];return s?this.where(s.name).equals(e[s.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,z(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var a in r)if(Y(r,a))try{i[a]=r[a]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){U(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=tt(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:n!=null?[n]:null,values:[o]})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{J(e,u,s)}catch{}return s})},t.prototype.update=function(e,n){if(typeof e=="object"&&!z(e)){var r=ue(e,this.schema.primKey.keyPath);if(r===void 0)return N(new C.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?j(n).forEach(function(i){J(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=tt(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:n!=null?[n]:null})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{J(e,u,s)}catch{}return s})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?A.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:tr})}).then(function(n){return n.numFailures?A.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,d=f&&c?e.map(tt(f)):e;return i.core.mutate({trans:o,type:"add",keys:a,values:d,wantResults:u}).then(function(b){var v=b.numFailures,h=b.results,y=b.lastResult,_=b.failures,w=u?h:y;if(v===0)return w;throw new Fe(i.name+".bulkAdd(): "+v+" of "+l+" operations failed",_)})})},t.prototype.bulkPut=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,d=f&&c?e.map(tt(f)):e;return i.core.mutate({trans:o,type:"put",keys:a,values:d,wantResults:u}).then(function(b){var v=b.numFailures,h=b.results,y=b.lastResult,_=b.failures,w=u?h:y;if(v===0)return w;throw new Fe(i.name+".bulkPut(): "+v+" of "+l+" operations failed",_)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Fe(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",o)})},t}();function Je(t){var e={},n=function(o,s){if(s){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return e[o].subscribe.apply(null,f),t}else if(typeof o=="string")return e[o]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=Ir),c||(c=O);var f={subscribers:[],fire:c,subscribe:function(l){f.subscribers.indexOf(l)===-1&&(f.subscribers.push(l),f.fire=s(f.fire,l))},unsubscribe:function(l){f.subscribers=f.subscribers.filter(function(d){return d!==l}),f.fire=f.subscribers.reduce(s,c)}};return e[o]=n[o]=f,f}function u(o){j(o).forEach(function(s){var c=o[s];if(z(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var f=a(s,Xe,function(){for(var d=arguments.length,b=new Array(d);d--;)b[d]=arguments[d];f.subscribers.forEach(function(v){On(function(){v.apply(null,b)})})});else throw new C.InvalidArgument("Invalid event config")})}}function $e(t,e){return ke(e).from({prototype:t}),e}function Ur(t){return $e(Wr.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Je(null,{creating:[Sr,O],reading:[Dr,Xe],updating:[Cr,O],deleting:[Kr,O]})})}function De(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Kt(t,e){t.filter=Ee(t.filter,e)}function Ct(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Ee(r(),e())}:e,t.justLimit=n&&!r}function Hr(t,e){t.isMatch=Ee(t.isMatch,e)}function lt(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new C.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function An(t,e,n){var r=lt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function nt(t,e,n,r){var i=t.replayFilter?Ee(t.filter,t.replayFilter()):t.filter;if(t.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(d){return s.stop(d)},function(d){return s.fail(d)})){var f=s.primaryKey,l=""+f;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(f)),Y(a,l)||(a[l]=!0,e(o,s,c))}};return Promise.all([t.or._iterate(u,n),Dn(An(t,r,n),t.algorithm,u,!t.keysOnly&&t.valueMapper)])}else return Dn(An(t,r,n),Ee(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Dn(t,e,n,r){var i=r?function(u,o,s){return n(r(u),o,s)}:n,a=F(i);return t.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!e||e(u,function(s){return o=s},function(s){u.stop(s),o=O},function(s){u.fail(s),o=O}))&&a(u.value,u,function(s){return o=s}),o()})})}function W(t,e){try{var n=Sn(t),r=Sn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Qr(Kn(t),Kn(e));case"Array":return Yr(t,e)}}catch{}return NaN}function Yr(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a){var u=W(t[a],e[a]);if(u!==0)return u}return n===r?0:n<r?-1:1}function Qr(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a)if(t[a]!==e[a])return t[a]<e[a]?-1:1;return n===r?0:n<r?-1:1}function Sn(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=Rt(t);return n==="ArrayBuffer"?"binary":n}function Kn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Xr=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,N.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,N.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ee(n.algorithm,e)},t.prototype._iterate=function(e,n){return nt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&U(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return nt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(De(i,!0))return a.count({trans:r,query:{index:lt(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return nt(i,function(){return++u,!1},r,a).then(function(){return u})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function u(c,f){return f?u(c[r[f]],f-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,f){var l=u(c,a),d=u(f,a);return l<d?-o:l>d?o:0}return this.toArray(function(c){return c.sort(s)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&De(i,!0)&&i.limit>0){var a=i.valueMapper,u=lt(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return nt(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,De(n)?Ct(n,function(){var r=e;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Ct(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ct(this._ctx,function(){var n=e;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},t.prototype.until=function(e,n){return Kt(this._ctx,function(r,i,a){return e(r.value)?(i(a),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return Kt(this._ctx,function(n){return e(n.value)}),Hr(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&De(n,!0)&&n.limit>0)return this._read(function(i){var a=lt(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Kt(this._ctx,function(i){var a=i.primaryKey.toString(),u=Y(r,a);return r[a]=!0,!u}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof e=="function")a=e;else{var u=j(e),o=u.length;a=function(_){for(var w=!1,m=0;m<o;++m){var g=u[m],p=e[g];ue(_,g)!==p&&(J(_,g,p),w=!0)}return w}}var s=r.table.core,c=s.schema.primaryKey,f=c.outbound,l=c.extractKey,d=n.db._options.modifyChunkSize||200,b=[],v=0,h=[],y=function(_,w){var m=w.failures,g=w.numFailures;v+=_-g;for(var p=0,x=j(m);p<x.length;p++){var S=x[p];b.push(m[S])}};return n.clone().primaryKeys().then(function(_){var w=function(m){var g=Math.min(d,_.length-m);return s.getMany({trans:i,keys:_.slice(m,m+g),cache:"immutable"}).then(function(p){for(var x=[],S=[],E=f?[]:null,K=[],I=0;I<g;++I){var R=p[I],B={value:Qe(R),primKey:_[m+I]};a.call(B,B.value,B)!==!1&&(B.value==null?K.push(_[m+I]):!f&&W(l(R),l(B.value))!==0?(K.push(_[m+I]),x.push(B.value)):(S.push(B.value),f&&E.push(_[m+I])))}var P=De(r)&&r.limit===1/0&&(typeof e!="function"||e===It)&&{index:r.index,range:r.range};return Promise.resolve(x.length>0&&s.mutate({trans:i,type:"add",values:x}).then(function(L){for(var k in L.failures)K.splice(parseInt(k),1);y(x.length,L)})).then(function(){return(S.length>0||P&&typeof e=="object")&&s.mutate({trans:i,type:"put",keys:E,values:S,criteria:P,changeSpec:typeof e!="function"&&e}).then(function(L){return y(S.length,L)})}).then(function(){return(K.length>0||P&&e===It)&&s.mutate({trans:i,type:"delete",keys:K,criteria:P}).then(function(L){return y(K.length,L)})}).then(function(){return _.length>m+g&&w(m+d)})})};return w(0).then(function(){if(b.length>0)throw new ft("Error modifying one or more objects",b,v,h);return _.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return De(e)&&(e.isPrimKey&&!zr||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,a=n;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new ft("Could not delete some values",Object.keys(s).map(function(f){return s[f]}),u-c);return u-c})})}):this.modify(It)},t}(),It=function(t,e){return e.value=null};function Gr(t){return $e(Xr.prototype,function(n,r){this.db=t;var i=tr,a=null;if(r)try{i=r()}catch(c){a=c}var u=n._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==Xe?s:null}})}function qr(t,e){return t<e?-1:t===e?0:1}function Jr(t,e){return t>e?-1:t===e?0:1}function H(t,e,n){var r=t instanceof rr?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Se(t){return new t.Collection(t,function(){return nr("")}).limit(0)}function $r(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Zr(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function ei(t,e,n,r,i,a){for(var u=Math.min(t.length,r.length),o=-1,s=0;s<u;++s){var c=e[s];if(c!==r[s])return i(t[s],n[s])<0?t.substr(0,s)+n[s]+n.substr(s+1):i(t[s],r[s])<0?t.substr(0,s)+r[s]+n.substr(s+1):o>=0?t.substr(0,o)+e[o]+n.substr(o+1):null;i(t[s],c)<0&&(o=s)}return u<r.length&&a==="next"?t+n.substr(t.length):u<t.length&&a==="prev"?t.substr(0,n.length):o<0?null:t.substr(0,o)+r[o]+n.substr(o+1)}function rt(t,e,n,r){var i,a,u,o,s,c,f,l=n.length;if(!n.every(function(h){return typeof h=="string"}))return H(t,Zn);function d(h){i=$r(h),a=Zr(h),u=h==="next"?qr:Jr;var y=n.map(function(_){return{lower:a(_),upper:i(_)}}).sort(function(_,w){return u(_.lower,w.lower)});o=y.map(function(_){return _.upper}),s=y.map(function(_){return _.lower}),c=h,f=h==="next"?"":r}d("next");var b=new t.Collection(t,function(){return fe(o[0],s[l-1]+r)});b._ondirectionchange=function(h){d(h)};var v=0;return b._addAlgorithm(function(h,y,_){var w=h.key;if(typeof w!="string")return!1;var m=a(w);if(e(m,s,v))return!0;for(var g=null,p=v;p<l;++p){var x=ei(w,m,o[p],s[p],u,c);x===null&&g===null?v=p+1:(g===null||u(g,x)>0)&&(g=x)}return y(g!==null?function(){h.continue(g+f)}:_),!1}),b}function fe(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function nr(t){return{type:1,lower:t,upper:t}}var rr=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?Se(this):new this.Collection(this,function(){return fe(e,n,!r,!i)})}catch{return H(this,ne)}},t.prototype.equals=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return nr(e)})},t.prototype.above=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(e,void 0,!1)})},t.prototype.below=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?H(this,Zn):this.between(e,e+ge,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):rt(this,function(n,r){return n.indexOf(r[0])===0},[e],ge)},t.prototype.equalsIgnoreCase=function(e){return rt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=ie.apply(Ke,arguments);return e.length===0?Se(this):rt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=ie.apply(Ke,arguments);return e.length===0?Se(this):rt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,ge)},t.prototype.anyOf=function(){var e=this,n=ie.apply(Ke,arguments),r=this._cmp;try{n.sort(r)}catch{return H(this,ne)}if(n.length===0)return Se(this);var i=new this.Collection(this,function(){return fe(n[0],n[n.length-1])});i._ondirectionchange=function(u){r=u==="next"?e._ascending:e._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,n[a])>0;)if(++a,a===n.length)return o(s),!1;return r(c,n[a])===0?!0:(o(function(){u.continue(n[a])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[Ht,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=ie.apply(Ke,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return H(this,ne)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Ht,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(e.length===0)return Se(this);if(!e.every(function(p){return p[0]!==void 0&&p[1]!==void 0&&a(p[0],p[1])<=0}))return H(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",C.InvalidArgument);var c=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0;function l(p,x){for(var S=0,E=p.length;S<E;++S){var K=p[S];if(i(x[0],K[1])<0&&i(x[1],K[0])>0){K[0]=o(K[0],x[0]),K[1]=s(K[1],x[1]);break}}return S===E&&p.push(x),p}var d=a;function b(p,x){return d(p[0],x[0])}var v;try{v=e.reduce(l,[]),v.sort(b)}catch{return H(this,ne)}var h=0,y=f?function(p){return a(p,v[h][1])>0}:function(p){return a(p,v[h][1])>=0},_=c?function(p){return u(p,v[h][0])>0}:function(p){return u(p,v[h][0])>=0};function w(p){return!y(p)&&!_(p)}var m=y,g=new this.Collection(this,function(){return fe(v[0][0],v[v.length-1][1],!c,!f)});return g._ondirectionchange=function(p){p==="next"?(m=y,d=a):(m=_,d=u),v.sort(b)},g._addAlgorithm(function(p,x,S){for(var E=p.key;m(E);)if(++h,h===v.length)return x(S),!1;return w(E)?!0:(r._cmp(E,v[h][1])===0||r._cmp(E,v[h][0])===0||x(function(){d===a?p.continue(v[h][0]):p.continue(v[h][1])}),!1)}),g},t.prototype.startsWithAnyOf=function(){var e=ie.apply(Ke,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?Se(this):this.inAnyRange(e.map(function(n){return[n,n+ge]})):H(this,"startsWithAnyOf() only works with strings")},t}();function ti(t){return $e(rr.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=t._deps.indexedDB;if(!a)throw new C.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(u,o){return a.cmp(o,u)},this._max=function(u,o){return a.cmp(u,o)>0?u:o},this._min=function(u,o){return a.cmp(u,o)<0?u:o},this._IDBKeyRange=t._deps.IDBKeyRange})}function ee(t){return F(function(e){return We(e),t(e.target.error),!1})}function We(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ue="storagemutated",de="x-storagemutated-1",ye=Je(null,Ue),ni=function(){function t(){}return t.prototype._lock=function(){return Oe(!D.global),++this._reculock,this._reculock===1&&!D.global&&(D.lockOwnerFor=this),this},t.prototype._unlock=function(){if(Oe(!D.global),--this._reculock===0)for(D.global||(D.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Re(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&D.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Oe(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new C.DatabaseClosed(i);case"MissingAPIError":throw new C.MissingAPI(i.message,i);default:throw new C.OpenFailed(i)}if(!this.active)throw new C.TransactionInactive;return Oe(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=F(function(a){We(a),n._reject(e.error)}),e.onabort=F(function(a){We(a),n.active&&n._reject(new C.Abort(e.error)),n.active=!1,n.on("abort").fire(a)}),e.oncomplete=F(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&ye.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return N(new C.ReadOnly("Transaction is readonly"));if(!this.active)return N(new C.TransactionInactive);if(this._locked())return new A(function(u,o){i._blockedFuncs.push([function(){i._promise(e,n,r).then(u,o)},D])});if(r)return ve(function(){var u=new A(function(o,s){i._lock();var c=n(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new A(function(u,o){var s=n(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=A.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=n._waitingFor;return new A(function(u,o){r.then(function(s){return n._waitingQueue.push(F(u.bind(null,s)))},function(s){return n._waitingQueue.push(F(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new C.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(Y(n,e))return n[e];var r=this.schema[e];if(!r)throw new C.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function ri(t){return $e(ni.prototype,function(n,r,i,a,u){var o=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=Je(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new A(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),N(s)})})}function Yt(t,e,n,r,i,a,u){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:a,src:(n&&!u?"&":"")+(r?"*":"")+(i?"++":"")+ir(e)}}function ir(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function ar(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Mn(n,function(r){return[r.name,r]})}}function ii(t){return t.length===1?t[0]:t}var He=function(t){try{return t.only([[]]),He=function(){return[[]]},[[]]}catch{return He=function(){return ge},ge}};function Qt(t){return t==null?function(){}:typeof t=="string"?ai(t):function(e){return ue(e,t)}}function ai(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return ue(n,t)}}function Cn(t){return[].slice.call(t)}var ui=0;function Ne(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function oi(t,e,n){function r(l,d){var b=Cn(l.objectStoreNames);return{schema:{name:l.name,tables:b.map(function(v){return d.objectStore(v)}).map(function(v){var h=v.keyPath,y=v.autoIncrement,_=z(h),w=h==null,m={},g={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w,compound:_,keyPath:h,autoIncrement:y,unique:!0,extractKey:Qt(h)},indexes:Cn(v.indexNames).map(function(p){return v.index(p)}).map(function(p){var x=p.name,S=p.unique,E=p.multiEntry,K=p.keyPath,I=z(K),R={name:x,compound:I,keyPath:K,unique:S,multiEntry:E,extractKey:Qt(K)};return m[Ne(K)]=R,R}),getIndexByKeyPath:function(p){return m[Ne(p)]}};return m[":id"]=g.primaryKey,h!=null&&(m[Ne(h)]=g.primaryKey),g})},hasGetAll:b.length>0&&"getAll"in d.objectStore(b[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=l.lower,b=l.upper,v=l.lowerOpen,h=l.upperOpen,y=d===void 0?b===void 0?null:e.upperBound(b,!!h):b===void 0?e.lowerBound(d,!!v):e.bound(d,b,!!v,!!h);return y}function a(l){var d=l.name;function b(y){var _=y.trans,w=y.type,m=y.keys,g=y.values,p=y.range;return new Promise(function(x,S){x=F(x);var E=_.objectStore(d),K=E.keyPath==null,I=w==="put"||w==="add";if(!I&&w!=="delete"&&w!=="deleteRange")throw new Error("Invalid operation type: "+w);var R=(m||g||{length:1}).length;if(m&&g&&m.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});var B,P=[],L=[],k=0,Q=function(Z){++k,We(Z)};if(w==="deleteRange"){if(p.type===4)return x({numFailures:k,failures:L,results:[],lastResult:void 0});p.type===3?P.push(B=E.clear()):P.push(B=E.delete(i(p)))}else{var G=I?K?[g,m]:[g,null]:[m,null],ce=G[0],$=G[1];if(I)for(var X=0;X<R;++X)P.push(B=$&&$[X]!==void 0?E[w](ce[X],$[X]):E[w](ce[X])),B.onerror=Q;else for(var X=0;X<R;++X)P.push(B=E[w](ce[X])),B.onerror=Q}var le=function(Z){var Be=Z.target.result;P.forEach(function(q,Ze){return q.error!=null&&(L[Ze]=q.error)}),x({numFailures:k,failures:L,results:w==="delete"?m:P.map(function(q){return q.result}),lastResult:Be})};B.onerror=function(Z){Q(Z),le(Z)},B.onsuccess=le})}function v(y){var _=y.trans,w=y.values,m=y.query,g=y.reverse,p=y.unique;return new Promise(function(x,S){x=F(x);var E=m.index,K=m.range,I=_.objectStore(d),R=E.isPrimaryKey?I:I.index(E.name),B=g?p?"prevunique":"prev":p?"nextunique":"next",P=w||!("openKeyCursor"in R)?R.openCursor(i(K),B):R.openKeyCursor(i(K),B);P.onerror=ee(S),P.onsuccess=F(function(L){var k=P.result;if(!k){x(null);return}k.___id=++ui,k.done=!1;var Q=k.continue.bind(k),G=k.continuePrimaryKey;G&&(G=G.bind(k));var ce=k.advance.bind(k),$=function(){throw new Error("Cursor not started")},X=function(){throw new Error("Cursor not stopped")};k.trans=_,k.stop=k.continue=k.continuePrimaryKey=k.advance=$,k.fail=F(S),k.next=function(){var le=this,Z=1;return this.start(function(){return Z--?le.continue():le.stop()}).then(function(){return le})},k.start=function(le){var Z=new Promise(function(q,Ze){q=F(q),P.onerror=ee(Ze),k.fail=Ze,k.stop=function(lr){k.stop=k.continue=k.continuePrimaryKey=k.advance=X,q(lr)}}),Be=function(){if(P.result)try{le()}catch(q){k.fail(q)}else k.done=!0,k.start=function(){throw new Error("Cursor behind last entry")},k.stop()};return P.onsuccess=F(function(q){P.onsuccess=Be,Be()}),k.continue=Q,k.continuePrimaryKey=G,k.advance=ce,Be(),Z},x(k)},S)})}function h(y){return function(_){return new Promise(function(w,m){w=F(w);var g=_.trans,p=_.values,x=_.limit,S=_.query,E=x===1/0?void 0:x,K=S.index,I=S.range,R=g.objectStore(d),B=K.isPrimaryKey?R:R.index(K.name),P=i(I);if(x===0)return w({result:[]});if(y){var L=p?B.getAll(P,E):B.getAllKeys(P,E);L.onsuccess=function(ce){return w({result:ce.target.result})},L.onerror=ee(m)}else{var k=0,Q=p||!("openKeyCursor"in B)?B.openCursor(P):B.openKeyCursor(P),G=[];Q.onsuccess=function(ce){var $=Q.result;if(!$)return w({result:G});if(G.push(p?$.value:$.primaryKey),++k===x)return w({result:G});$.continue()},Q.onerror=ee(m)}})}}return{name:d,schema:l,mutate:b,getMany:function(y){var _=y.trans,w=y.keys;return new Promise(function(m,g){m=F(m);for(var p=_.objectStore(d),x=w.length,S=new Array(x),E=0,K=0,I,R=function(k){var Q=k.target;(S[Q._pos]=Q.result)!=null,++K===E&&m(S)},B=ee(g),P=0;P<x;++P){var L=w[P];L!=null&&(I=p.get(w[P]),I._pos=P,I.onsuccess=R,I.onerror=B,++E)}E===0&&m(S)})},get:function(y){var _=y.trans,w=y.key;return new Promise(function(m,g){m=F(m);var p=_.objectStore(d),x=p.get(w);x.onsuccess=function(S){return m(S.target.result)},x.onerror=ee(g)})},query:h(s),openCursor:v,count:function(y){var _=y.query,w=y.trans,m=_.index,g=_.range;return new Promise(function(p,x){var S=w.objectStore(d),E=m.isPrimaryKey?S:S.index(m.name),K=i(g),I=K?E.count(K):E.count();I.onsuccess=F(function(R){return p(R.target.result)}),I.onerror=ee(x)})}}}var u=r(t,n),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),f={};return c.forEach(function(l){return f[l.name]=l}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(l){var d=f[l];if(!d)throw new Error("Table '"+l+"' not found");return f[l]},MIN_KEY:-1/0,MAX_KEY:He(e),schema:o}}function si(t,e){return e.reduce(function(n,r){var i=r.create;return T(T({},n),i(n))},t)}function ci(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=si(oi(e,i,r),t.dbcore);return{dbcore:a}}function fn(t,e){var n=t._novip,r=e.db,i=ci(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(a){var u=a.name;n.core.schema.tables.some(function(o){return o.name===u})&&(a.core=n.core.table(u),n[u]instanceof n.Table&&(n[u].core=a.core))})}function mt(t,e,n,r){var i=t._novip;n.forEach(function(a){var u=r[a];e.forEach(function(o){var s=tn(o,a);(!s||"value"in s&&s.value===void 0)&&(o===i.Transaction.prototype||o instanceof i.Transaction?oe(o,a,{get:function(){return this.table(a)},set:function(c){Rn(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new i.Table(a,u))})})}function Xt(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function li(t,e){return t._cfg.version-e._cfg.version}function fi(t,e,n,r){var i=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,i);a.create(n),a._completion.catch(r);var u=a._reject.bind(a),o=D.transless||D;ve(function(){D.trans=a,D.transless=o,e===0?(j(i).forEach(function(s){hn(n,s,i[s].primKey,i[s].indexes)}),fn(t,n),A.follow(function(){return t.on.populate.fire(a)}).catch(u)):hi(t,e,a,n).catch(u)})}function hi(t,e,n,r){var i=t._novip,a=[],u=i._versions,o=i._dbSchema=dn(i,i.idbdb,r),s=!1,c=u.filter(function(l){return l._cfg.version>=e});c.forEach(function(l){a.push(function(){var d=o,b=l._cfg.dbschema;qt(i,d,r),qt(i,b,r),o=i._dbSchema=b;var v=ur(d,b);v.add.forEach(function(g){hn(r,g[0],g[1].primKey,g[1].indexes)}),v.change.forEach(function(g){if(g.recreate)throw new C.Upgrade("Not yet support for changing primary key");var p=r.objectStore(g.name);g.add.forEach(function(x){return Gt(p,x)}),g.change.forEach(function(x){p.deleteIndex(x.name),Gt(p,x)}),g.del.forEach(function(x){return p.deleteIndex(x)})});var h=l._cfg.contentUpgrade;if(h&&l._cfg.version>e){fn(i,r),n._memoizedTables={},s=!0;var y=Fn(b);v.del.forEach(function(g){y[g]=d[g]}),Xt(i,[i.Transaction.prototype]),mt(i,[i.Transaction.prototype],j(y),y),n.schema=y;var _=nn(h);_&&Pe();var w,m=A.follow(function(){if(w=h(n),w&&_){var g=se.bind(null,null);w.then(g,g)}});return w&&typeof w.then=="function"?A.resolve(w):m.then(function(){return w})}}),a.push(function(d){if(!s||!Vr){var b=l._cfg.dbschema;vi(b,d)}Xt(i,[i.Transaction.prototype]),mt(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function f(){return a.length?A.resolve(a.shift()(n.idbtrans)).then(f):A.resolve()}return f().then(function(){di(o,r)})}function ur(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],a=e[r];if(!i)n.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!xt)u.recreate=!0,n.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var f=o[c],l=s[c];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}}return n}function hn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Gt(i,a)}),i}function di(t,e){j(t).forEach(function(n){e.db.objectStoreNames.contains(n)||hn(e,n,t[n].primKey,t[n].indexes)})}function vi(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function Gt(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function dn(t,e,n){var r={},i=_t(e.objectStoreNames,0);return i.forEach(function(a){for(var u=n.objectStore(a),o=u.keyPath,s=Yt(ir(o),o||"",!1,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],f=0;f<u.indexNames.length;++f){var l=u.index(u.indexNames[f]);o=l.keyPath;var d=Yt(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(d)}r[a]=ar(a,s,c)}),r}function pi(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=dn(r,e,n);r._storeNames=_t(e.objectStoreNames,0),mt(r,[r._allTables],j(i),i)}function yi(t,e){var n=dn(t,t.idbdb,e),r=ur(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function qt(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var u=i[a],o=n.objectStore(u);r._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],f=o.index(c).keyPath,l=typeof f=="string"?f:"["+_t(f).join("+")+"]";if(e[u]){var d=e[u].idxByName[l];d&&(d.name=c,delete e[u].idxByName[l],e[u].idxByName[c]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&M.WorkerGlobalScope&&M instanceof M.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function mi(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Yt(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),z(i),n===0)})}var gi=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){j(e).forEach(function(r){if(e[r]!==null){var i=mi(e[r]),a=i.shift();if(a.multi)throw new C.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new C.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new C.Schema("Index must have a name and cannot be an empty string")}),n[r]=ar(r,a,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?U(this._cfg.storesSource,e):e;var r=n._versions,i={},a={};return r.forEach(function(u){U(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),n._dbSchema=a,Xt(n,[n._allTables,n,n.Transaction.prototype]),mt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],j(a),a),n._storeNames=j(a),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=un(this._cfg.contentUpgrade||O,e),this},t}();function bi(t){return $e(gi.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function vn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new gn(Et,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function pn(t){return t&&typeof t.databases=="function"}function _i(t){var e=t.indexedDB,n=t.IDBKeyRange;return pn(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Et})}):vn(e,n).toCollection().primaryKeys()}function wi(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!pn(n)&&e!==Et&&vn(n,r).put({name:e}).catch(O)}function xi(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!pn(n)&&e!==Et&&vn(n,r).delete(e).catch(O)}function Jt(t){return ve(function(){return D.letThrough=!0,t()})}function Ei(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Ai(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?N(e.dbOpenError):t});te&&(e.openCanceller._stackHolder=Ae()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new C.DatabaseClosed("db.open() was cancelled")}var a=e.dbReadyResolve,u=null,o=!1;return A.race([r,(typeof navigator>"u"?A.resolve():Ei()).then(function(){return new A(function(s,c){if(i(),!n)throw new C.MissingAPI;var f=t.name,l=e.autoSchema?n.open(f):n.open(f,Math.round(t.verno*10));if(!l)throw new C.MissingAPI;l.onerror=ee(c),l.onblocked=F(t._fireOnBlocked),l.onupgradeneeded=F(function(d){if(u=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=We,u.abort(),l.result.close();var b=n.deleteDatabase(f);b.onsuccess=b.onerror=F(function(){c(new C.NoSuchDatabase("Database "+f+" doesnt exist"))})}else{u.onerror=ee(c);var v=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;o=v<1,t._novip.idbdb=l.result,fi(t,v/10,u,c)}},c),l.onsuccess=F(function(){u=null;var d=t._novip.idbdb=l.result,b=_t(d.objectStoreNames);if(b.length>0)try{var v=d.transaction(ii(b),"readonly");e.autoSchema?pi(t,d,v):(qt(t,t._dbSchema,v),yi(t,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),fn(t,v)}catch{}je.push(t),d.onversionchange=F(function(h){e.vcFired=!0,t.on("versionchange").fire(h)}),d.onclose=F(function(h){t.on("close").fire(h)}),o&&wi(t._deps,f),s()},c)})})]).then(function(){return i(),e.onReadyBeingFired=[],A.resolve(Jt(function(){return t.on.ready.fire(t.vip)})).then(function s(){if(e.onReadyBeingFired.length>0){var c=e.onReadyBeingFired.reduce(un,O);return e.onReadyBeingFired=[],A.resolve(Jt(function(){return c(t.vip)})).then(s)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(s){e.dbOpenError=s;try{u&&u.abort()}catch{}return r===e.openCanceller&&t._close(),N(s)}).finally(function(){e.openComplete=!0,a()})}function $t(t){var e=function(u){return t.next(u)},n=function(u){return t.throw(u)},r=a(e),i=a(n);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?z(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(e)()}function Di(t,e,n){var r=arguments.length;if(r<2)throw new C.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=jn(i);return[t,a,n]}function or(t,e,n,r,i){return A.resolve().then(function(){var a=D.transless||D,u=t._createTransaction(e,n,t._dbSchema,r),o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===an.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return or(t,e,n,null,i)})):N(l)}var s=nn(i);s&&Pe();var c,f=A.follow(function(){if(c=i.call(u,u),c)if(s){var l=se.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=$t(c))},o);return(c&&typeof c.then=="function"?A.resolve(c).then(function(l){return u.active?l:N(new C.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),N(l)})})}function it(t,e,n){for(var r=z(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function Si(t){return T(T({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},a=[];function u(h,y,_){var w=Ne(h),m=i[w]=i[w]||[],g=h==null?0:typeof h=="string"?1:h.length,p=y>0,x=T(T({},_),{isVirtual:p,keyTail:y,keyLength:g,extractKey:Qt(h),unique:!p&&_.unique});if(m.push(x),x.isPrimaryKey||a.push(x),g>1){var S=g===2?h[0]:h.slice(0,g-1);u(S,y+1,_)}return m.sort(function(E,K){return E.keyTail-K.keyTail}),x}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var f=c[s];u(f.keyPath,0,f)}function l(h){var y=i[Ne(h)];return y&&y[0]}function d(h,y){return{type:h.type===1?2:h.type,lower:it(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,y),lowerOpen:!0,upper:it(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,y),upperOpen:!0}}function b(h){var y=h.query.index;return y.isVirtual?T(T({},h),{query:{index:y,range:d(h.query.range,y.keyTail)}}):h}var v=T(T({},n),{schema:T(T({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(h){return n.count(b(h))},query:function(h){return n.query(b(h))},openCursor:function(h){var y=h.query.index,_=y.keyTail,w=y.isVirtual,m=y.keyLength;if(!w)return n.openCursor(h);function g(p){function x(E){E!=null?p.continue(it(E,h.reverse?t.MAX_KEY:t.MIN_KEY,_)):h.unique?p.continue(p.key.slice(0,m).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,_)):p.continue()}var S=Object.create(p,{continue:{value:x},continuePrimaryKey:{value:function(E,K){p.continuePrimaryKey(it(E,t.MAX_KEY,_),K)}},primaryKey:{get:function(){return p.primaryKey}},key:{get:function(){var E=p.key;return m===1?E[0]:E.slice(0,m)}},value:{get:function(){return p.value}}});return S}return n.openCursor(b(h)).then(function(p){return p&&g(p)})}});return v}})}var Ki={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Si};function yn(t,e,n,r){return n=n||{},r=r||"",j(t).forEach(function(i){if(!Y(e,i))n[r+i]=void 0;else{var a=t[i],u=e[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Rt(a),s=Rt(u);o!==s?n[r+i]=e[i]:o==="Object"?yn(a,u,n,r+i+"."):a!==u&&(n[r+i]=e[i])}else a!==u&&(n[r+i]=e[i])}}),j(e).forEach(function(i){Y(t,i)||(n[r+i]=e[i])}),n}function Ci(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ii={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return T(T({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=T(T({},n),{mutate:function(a){var u=D.trans,o=u.table(e).hook,s=o.deleting,c=o.creating,f=o.updating;switch(a.type){case"add":if(c.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===O&&f.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===O)break;return u._promise("readwrite",function(){return d(a)},!0)}return n.mutate(a);function l(v){var h=D.trans,y=v.keys||Ci(r,v);if(!y)throw new Error("Keys missing");return v=v.type==="add"||v.type==="put"?T(T({},v),{keys:y}):T({},v),v.type!=="delete"&&(v.values=Tt([],v.values,!0)),v.keys&&(v.keys=Tt([],v.keys,!0)),ki(n,v,y).then(function(_){var w=y.map(function(m,g){var p=_[g],x={onerror:null,onsuccess:null};if(v.type==="delete")s.fire.call(x,m,p,h);else if(v.type==="add"||p===void 0){var S=c.fire.call(x,m,v.values[g],h);m==null&&S!=null&&(m=S,v.keys[g]=m,r.outbound||J(v.values[g],r.keyPath,m))}else{var E=yn(p,v.values[g]),K=f.fire.call(x,E,m,p,h);if(K){var I=v.values[g];Object.keys(K).forEach(function(R){Y(I,R)?I[R]=K[R]:J(I,R,K[R])})}}return x});return n.mutate(v).then(function(m){for(var g=m.failures,p=m.results,x=m.numFailures,S=m.lastResult,E=0;E<y.length;++E){var K=p?p[E]:y[E],I=w[E];K==null?I.onerror&&I.onerror(g[E]):I.onsuccess&&I.onsuccess(v.type==="put"&&_[E]?v.values[E]:K)}return{failures:g,results:p,numFailures:x,lastResult:S}}).catch(function(m){return w.forEach(function(g){return g.onerror&&g.onerror(m)}),Promise.reject(m)})})}function d(v){return b(v.trans,v.range,1e4)}function b(v,h,y){return n.query({trans:v,values:!1,query:{index:r,range:h},limit:y}).then(function(_){var w=_.result;return l({type:"delete",keys:w,trans:v}).then(function(m){return m.numFailures>0?Promise.reject(m.failures[0]):w.length<y?{failures:[],numFailures:0,lastResult:void 0}:b(v,T(T({},h),{lower:w[w.length-1],lowerOpen:!0}),y)})})}}});return i}})}};function ki(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function sr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,a=0;i<e.keys.length&&a<t.length;++i)W(e.keys[i],t[a])===0&&(r.push(n?Qe(e.values[i]):e.values[i]),++a);return r.length===t.length?r:null}catch{return null}}var Ti={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return T(T({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=sr(r.keys,r.trans._cache,r.cache==="clone");return i?A.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Qe(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},kt;function mn(t){return!("from"in t)}var re=function(t,e){if(this)U(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new re;return t&&"d"in t&&U(n,t),n}};Ie(re.prototype,(kt={add:function(t){return gt(this,t),this},addKey:function(t){return Ye(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Ye(e,n,n)}),this}},kt[Bt]=function(){return Zt(this)},kt));function Ye(t,e,n){var r=W(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(mn(t))return U(t,{from:e,to:n,d:1});var i=t.l,a=t.r;if(W(n,t.from)<0)return i?Ye(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},In(t);if(W(e,t.to)>0)return a?Ye(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},In(t);W(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),W(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var u=!t.r;i&&!t.l&&gt(t,i),a&&u&&gt(t,a)}}function gt(t,e){function n(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;Ye(r,a,u),o&&n(r,o),s&&n(r,s)}mn(e)||n(t,e)}function Pi(t,e){var n=Zt(e),r=n.next();if(r.done)return!1;for(var i=r.value,a=Zt(t),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(W(o.from,i.to)<=0&&W(o.to,i.from)>=0)return!0;W(i.from,o.from)<0?i=(r=n.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function Zt(t){var e=mn(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&W(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||W(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function In(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=T({},t),o=t[i];t.from=o.from,t.to=o.to,t[i]=o[i],u[i]=o[a],t[a]=u,u.d=kn(u)}t.d=kn(t)}function kn(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Ri={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new re(t.MIN_KEY,t.MAX_KEY);return T(T({},t),{table:function(r){var i=t.table(r),a=i.schema,u=a.primaryKey,o=u.extractKey,s=u.outbound,c=T(T({},i),{mutate:function(d){var b=d.trans,v=b.mutatedParts||(b.mutatedParts={}),h=function(S){var E="idb://"+e+"/"+r+"/"+S;return v[E]||(v[E]=new re)},y=h(""),_=h(":dels"),w=d.type,m=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[],g=m[0],p=m[1],x=d.trans._cache;return i.mutate(d).then(function(S){if(z(g)){w!=="delete"&&(g=S.results),y.addKeys(g);var E=sr(g,x);!E&&w!=="add"&&_.addKeys(g),(E||p)&&Bi(h,a,E,p)}else if(g){var K={from:g.lower,to:g.upper};_.add(K),y.add(K)}else y.add(n),_.add(n),a.indexes.forEach(function(I){return h(I.name).add(n)});return S})}}),f=function(d){var b,v,h=d.query,y=h.index,_=h.range;return[y,new re((b=_.lower)!==null&&b!==void 0?b:t.MIN_KEY,(v=_.upper)!==null&&v!==void 0?v:t.MAX_KEY)]},l={get:function(d){return[u,new re(d.key)]},getMany:function(d){return[u,new re().addKeys(d.keys)]},count:f,query:f,openCursor:f};return j(l).forEach(function(d){c[d]=function(b){var v=D.subscr;if(v){var h=function(x){var S="idb://"+e+"/"+r+"/"+x;return v[S]||(v[S]=new re)},y=h(""),_=h(":dels"),w=l[d](b),m=w[0],g=w[1];if(h(m.name||"").add(g),!m.isPrimaryKey)if(d==="count")_.add(n);else{var p=d==="query"&&s&&b.values&&i.query(T(T({},b),{values:!1}));return i[d].apply(this,arguments).then(function(x){if(d==="query"){if(s&&b.values)return p.then(function(I){var R=I.result;return y.addKeys(R),x});var S=b.values?x.result.map(o):x.result;b.values?y.addKeys(S):_.addKeys(S)}else if(d==="openCursor"){var E=x,K=b.values;return E&&Object.create(E,{key:{get:function(){return _.addKey(E.primaryKey),E.key}},primaryKey:{get:function(){var I=E.primaryKey;return _.addKey(I),I}},value:{get:function(){return K&&y.addKey(E.primaryKey),E.value}}})}return x})}}return i[d].apply(this,arguments)}}),c}})}};function Bi(t,e,n,r){function i(a){var u=t(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&z(c)?c.forEach(function(f){return u.addKey(f)}):u.addKey(c)};(n||r).forEach(function(c,f){var l=n&&o(n[f]),d=r&&o(r[f]);W(l,d)!==0&&(l!=null&&s(l),d!=null&&s(d))})}e.indexes.forEach(i)}var gn=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=T({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:O,dbReadyPromise:null,cancelOpen:O,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};u.dbReadyPromise=new A(function(o){u.dbReadyResolve=o}),u.openCanceller=new A(function(o,s){u.cancelOpen=s}),this._state=u,this.name=e,this.on=Je(this,"populate","blocked","versionchange","close",{ready:[un,O]}),this.on.ready.subscribe=Bn(this.on.ready.subscribe,function(o){return function(s,c){t.vip(function(){var f=r._state;if(f.openComplete)f.dbOpenError||A.resolve().then(s),c&&o(s);else if(f.onReadyBeingFired)f.onReadyBeingFired.push(s),c&&o(s);else{o(s);var l=r;c||o(function d(){l.on.ready.unsubscribe(s),l.on.ready.unsubscribe(d)})}})}}),this.Collection=Gr(this),this.Table=Ur(this),this.Transaction=ri(this),this.Version=bi(this),this.WhereClause=ti(this),this.on("versionchange",function(o){o.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(o){!o.newVersion||o.newVersion<o.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+o.oldVersion/10)}),this._maxKey=He(n.IDBKeyRange),this._createTransaction=function(o,s,c,f){return new r.Transaction(o,s,c,r._options.chromeTransactionDurability,f)},this._fireOnBlocked=function(o){r.on("blocked").fire(o),je.filter(function(s){return s.name===r.name&&s!==r&&!s._state.vcFired}).map(function(s){return s.on("versionchange").fire(o)})},this.use(Ki),this.use(Ii),this.use(Ri),this.use(Ti),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(o){return o(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new C.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new C.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(li),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||D.letThrough||this._vip)?e():new A(function(r,i){if(n._state.openComplete)return i(new C.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new C.DatabaseClosed);return}n.open().catch(O)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,a=e.name;a&&this.unuse({stack:n,name:a});var u=this._middlewares[n]||(this._middlewares[n]=[]);return u.push({stack:n,create:r,level:i==null?10:i,name:a}),u.sort(function(o,s){return o.level-s.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},t.prototype.open=function(){return Ai(this)},t.prototype._close=function(){var e=this._state,n=je.indexOf(this);if(n>=0&&je.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new A(function(r){e.dbReadyResolve=r}),e.openCanceller=new A(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new C.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new A(function(i,a){var u=function(){e.close();var o=e._deps.indexedDB.deleteDatabase(e.name);o.onsuccess=F(function(){xi(e._deps,e.name),i()}),o.onerror=ee(a),o.onblocked=e._fireOnBlocked};if(n)throw new C.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return j(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=Di.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,a=D.trans;(!a||a.db!==this||e.indexOf("!")!==-1)&&(a=null);var u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var o,s;try{if(s=n.map(function(f){var l=f instanceof i.Table?f.name:f;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),e=="r"||e===Dt)o=Dt;else if(e=="rw"||e==St)o=St;else throw new C.InvalidArgument("Invalid transaction mode: "+e);if(a){if(a.mode===Dt&&o===St)if(u)a=null;else throw new C.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(f){if(a&&a.storeNames.indexOf(f)===-1)if(u)a=null;else throw new C.SubTransaction("Table "+f+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(f){return a?a._promise(null,function(l,d){d(f)}):N(f)}var c=or.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):D.trans?Re(D.transless,function(){return i._whenReady(c)}):this._whenReady(c)},t.prototype.table=function(e){if(!Y(this._allTables,e))throw new C.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Oi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Mi=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Oi]=function(){return this},t}();function cr(t,e){return j(e).forEach(function(n){var r=t[n]||(t[n]=new re);gt(r,e[n])}),t}function Fi(t){return new Mi(function(e){var n=nn(t);function r(b){n&&Pe();var v=function(){return ve(t,{subscr:b,trans:null})},h=D.trans?Re(D.transless,v):v();return n&&h.then(se,se),h}var i=!1,a={},u={},o={get closed(){return i},unsubscribe:function(){i=!0,ye.storagemutated.unsubscribe(l)}};e.start&&e.start(o);var s=!1,c=!1;function f(){return j(u).some(function(b){return a[b]&&Pi(a[b],u[b])})}var l=function(b){cr(a,b),f()&&d()},d=function(){if(!(s||i)){a={};var b={},v=r(b);c||(ye(Ue,l),c=!0),s=!0,Promise.resolve(v).then(function(h){s=!1,!i&&(f()?d():(a={},u=b,e.next&&e.next(h)))},function(h){s=!1,e.error&&e.error(h),o.unsubscribe()})}};return d(),o})}var en;try{en={indexedDB:M.indexedDB||M.mozIndexedDB||M.webkitIndexedDB||M.msIndexedDB,IDBKeyRange:M.IDBKeyRange||M.webkitIDBKeyRange}}catch{en={indexedDB:null,IDBKeyRange:null}}var me=gn;Ie(me,T(T({},wt),{delete:function(t){var e=new me(t,{addons:[]});return e.delete()},exists:function(t){return new me(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return _i(me.dependencies).then(t)}catch{return N(new C.MissingAPI)}},defineClass:function(){function t(e){U(this,e)}return t},ignoreTransaction:function(t){return D.trans?Re(D.transless,t):t()},vip:Jt,async:function(t){return function(){try{var e=$t(t.apply(this,arguments));return!e||typeof e.then!="function"?A.resolve(e):e}catch(n){return N(n)}}},spawn:function(t,e,n){try{var r=$t(t.apply(n,e||[]));return!r||typeof r.then!="function"?A.resolve(r):r}catch(i){return N(i)}},currentTransaction:{get:function(){return D.trans||null}},waitFor:function(t,e){var n=A.resolve(typeof t=="function"?me.ignoreTransaction(t):t).timeout(e||6e4);return D.trans?D.trans.waitFor(n):n},Promise:A,debug:{get:function(){return te},set:function(t){Ln(t,t==="dexie"?function(){return!0}:er)}},derive:ke,extend:U,props:Ie,override:Bn,Events:Je,on:ye,liveQuery:Fi,extendObservabilitySet:cr,getByKeyPath:ue,setByKeyPath:J,delByKeyPath:pr,shallowClone:Fn,deepClone:Qe,getObjectDiff:yn,cmp:W,asap:On,minKey:Ht,addons:[],connections:je,errnames:an,dependencies:en,semVer:En,version:En.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));me.maxKey=He(me.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ye(Ue,function(t){if(!ae){var e;xt?(e=document.createEvent("CustomEvent"),e.initCustomEvent(de,!0,!0,t)):e=new CustomEvent(de,{detail:t}),ae=!0,dispatchEvent(e),ae=!1}}),addEventListener(de,function(t){var e=t.detail;ae||bt(e)}));function bt(t){var e=ae;try{ae=!0,ye.storagemutated.fire(t)}finally{ae=e}}var ae=!1;if(typeof BroadcastChannel<"u"){var Tn=new BroadcastChannel(de);ye(Ue,function(t){ae||Tn.postMessage(t)}),Tn.onmessage=function(t){t.data&&bt(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ye(Ue,function(t){try{ae||(typeof localStorage<"u"&&localStorage.setItem(de,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&Tt([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:de,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===de){var e=JSON.parse(t.newValue);e&&bt(e.changedParts)}});var Pn=self.document&&navigator.serviceWorker;Pn&&Pn.addEventListener("message",ji)}function ji(t){var e=t.data;e&&e.type===de&&bt(e.changedParts)}A.rejectionMapper=Ar;Ln(te,er);const Ni={theme:"light"};class Li extends gn{constructor(){super("DB"),this.version(1).stores({course:"++id, cID",lesson:"++id, lID, cID, [cID+lID]",task:"++id, qID, lID, cID, status, [cID+lID+qID], [cID+lID]",taskProgress:"++id, qID, lID, cID, status, [cID+lID+qID], [cID+lID]",settings:"++id"})}}const be=new Li,Vi=async()=>{(await be.settings.toArray()).length===0&&await be.settings.add(Ni)},zi=async()=>{try{await be.delete()}catch(t){console.log(t)}},Wi=async()=>{try{await be.course.clear(),await be.lesson.clear(),await be.task.clear(),await be.taskProgress.clear()}catch(t){console.log(t)}};export{Wi as a,zi as b,be as d,Vi as i};
